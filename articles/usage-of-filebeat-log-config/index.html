<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#464159">
<meta name="generator" content="Hexo 3.7.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.6.2">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.6.2">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.6.2">
  <link rel="mask-icon" href="/images/logo.svg?v=7.6.2" color="#464159">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="google-site-verification" content="gcDrMPbZlMtAIc7xAPBwFUjnApzpvfqSbVIKT3R8fbA">
  <meta name="baidu-site-verification" content="F7xr7OXgnX">

<link rel="stylesheet" href="/css/main.css?v=7.6.2">


<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://www.cyhone.com').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.6.2',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":"default"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":false,"async":false,"transition":{"post_block":null,"post_header":null,"post_body":null,"coll_header":null,"sidebar":null}}
  };
</script>

  <meta name="description" content="本文主要介绍 Filebeat 7.5 版本中 Log 相关的各个配置项的含义以及其应用场景。 一般情况下，我们使用 log input 的方式如下，只需要指定一系列 paths 即可。 filebeat.inputs:- type: log  paths:    - /var/log/messages    - /var/log/*.log 但其实除了基本的 paths 配置外，log inpu">
<meta name="keywords" content="Golang,Filebeat,Elasticsearch,大数据">
<meta property="og:type" content="article">
<meta property="og:title" content="FileBeat-Log 相关配置指南">
<meta property="og:url" content="http://www.cyhone.com/articles/usage-of-filebeat-log-config/index.html">
<meta property="og:site_name" content="编程沉思录">
<meta property="og:description" content="本文主要介绍 Filebeat 7.5 版本中 Log 相关的各个配置项的含义以及其应用场景。 一般情况下，我们使用 log input 的方式如下，只需要指定一系列 paths 即可。 filebeat.inputs:- type: log  paths:    - /var/log/messages    - /var/log/*.log 但其实除了基本的 paths 配置外，log inpu">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-12-17T10:40:38.022Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="FileBeat-Log 相关配置指南">
<meta name="twitter:description" content="本文主要介绍 Filebeat 7.5 版本中 Log 相关的各个配置项的含义以及其应用场景。 一般情况下，我们使用 log input 的方式如下，只需要指定一系列 paths 即可。 filebeat.inputs:- type: log  paths:    - /var/log/messages    - /var/log/*.log 但其实除了基本的 paths 配置外，log inpu">

<link rel="canonical" href="http://www.cyhone.com/articles/usage-of-filebeat-log-config/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>FileBeat-Log 相关配置指南 | 编程沉思录</title>
  


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ec99ce8d168c9260e5d744401582acc9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">编程沉思录</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">一些思考和总结</h1>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类<span class="badge">10</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">25</span></a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">29</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/chenyahui" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.cyhone.com/articles/usage-of-filebeat-log-config/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/img/avatar.jpg">
      <meta itemprop="name" content="cyhone">
      <meta itemprop="description" content="每有会意，便欣然忘食">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="编程沉思录">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          FileBeat-Log 相关配置指南
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-26 20:36:54" itemprop="dateCreated datePublished" datetime="2019-11-26T20:36:54+08:00">2019-11-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-12-17 18:40:38" itemprop="dateModified" datetime="2019-12-17T18:40:38+08:00">2019-12-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Elasticsearch/" itemprop="url" rel="index">
                    <span itemprop="name">Elasticsearch</span>
                  </a>
                </span>
            </span>

          
            <span id="/articles/usage-of-filebeat-log-config/" class="post-meta-item leancloud_visitors" data-flag-title="FileBeat-Log 相关配置指南" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/articles/usage-of-filebeat-log-config/#comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/articles/usage-of-filebeat-log-config/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>本文主要介绍 Filebeat 7.5 版本中 Log 相关的各个配置项的含义以及其应用场景。</p>
<p>一般情况下，我们使用 log input 的方式如下，只需要指定一系列 paths 即可。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">filebeat.inputs:</span></span><br><span class="line"><span class="attr">- type:</span> <span class="string">log</span></span><br><span class="line"><span class="attr">  paths:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">/var/log/messages</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">/var/log/*.log</span></span><br></pre></td></tr></table></figure>
<p>但其实除了基本的 paths 配置外，log input 还有大概十几个配置项需要我们关注。</p>
<p>这些配置项或多或少都会影响到 Filebeat 的使用方式以及性能。虽然其默认值基本足够日常使用，但是还是需要深刻理解每个配置项背后的含义，这样才能够对其完全把控。</p>
<p>同时，在 filebeat 的日常线上运维中，也会涉及到这些配置参数的调节。</p>
<a id="more"></a>
<h1 id="log-input-配置"><a class="markdownIt-Anchor" href="#log-input-配置"></a> log input 配置</h1>
<h2 id="paths"><a class="markdownIt-Anchor" href="#paths"></a> paths</h2>
<p>我们可以指定一系列的 paths 作为信息输入源，在指定 path 的时候，注意以下规则：</p>
<ol>
<li>指定的路径必须是文件，不能是目录。</li>
<li>支持 Glob 模式。</li>
<li>默认支持递归路径，如 <code>/**/</code> 形式，Filebeat 将会展开 8 层嵌套目录。</li>
</ol>
<h3 id="glob-模式"><a class="markdownIt-Anchor" href="#glob-模式"></a> Glob 模式</h3>
<p>Glob 模式支持通配符匹配，目前支持的语法有：</p>
<table>
<thead>
<tr>
<th>通配符</th>
<th>解释</th>
<th>示例</th>
<th>匹配</th>
</tr>
</thead>
<tbody>
<tr>
<td>*</td>
<td>匹配任意数目的任意字符</td>
<td><code>La*</code></td>
<td>Law, Lawyer</td>
</tr>
<tr>
<td>?</td>
<td>匹配任意的单字符</td>
<td><code>?at</code></td>
<td>Cat, cat, Bat or bat</td>
</tr>
<tr>
<td>[abc]</td>
<td>匹配一个在中括号的字符</td>
<td><code>[CB]at</code></td>
<td>Cat or Bat</td>
</tr>
<tr>
<td>[a-z]</td>
<td>匹配一个指定范围的字符</td>
<td><code>Letter[0-9]</code></td>
<td>Letter0, Letter1, Letter2 up to Letter9</td>
</tr>
</tbody>
</table>
<h3 id="递归的-glob-模式"><a class="markdownIt-Anchor" href="#递归的-glob-模式"></a> 递归的 Glob 模式</h3>
<p>此外，filebeat 对传统的 Glob 模式进行了扩展，支持用户指定 <code>/**/</code> 模式的路径，filebeat 可以将其展开为 8 层的 Glob 路径。</p>
<p>例如，假如指定了 <code>/home/data/**/my*.log</code>, filebeat 将会把 <code>/**/</code> 翻译成 8 层的子目录，如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/home/data/my*.log</span><br><span class="line">/home/data/*/my*.log</span><br><span class="line">/home/data/*/*/my*.log</span><br><span class="line">/home/data/*/*/*/my*.log</span><br><span class="line">/home/data/*/*/*/*/my*.log</span><br><span class="line">/home/data/*/*/*/*/*/my*.log</span><br><span class="line">/home/data/*/*/*/*/*/*/my*.log</span><br><span class="line">/home/data/*/*/*/*/*/*/*/my*.log</span><br><span class="line">/home/data/*/*/*/*/*/*/*/*/my*.log</span><br></pre></td></tr></table></figure>
<p>加上不带子目录的 Glob 路径，一共会有 8 条 Glob 路径。这些路径都会作为 input 的输入源路径进行搜索。</p>
<p>但是在使用的时候需要注意：</p>
<ol>
<li>filebeat 展开为 8 层子目录的规则，是直接 hardcode 在代码中的，无法通过配置修改匹配层数</li>
<li>只支持单纯的 <code>/**/</code> 模式，对于 <code>/data**/</code> 模式不支持</li>
<li>递归模式默认开启，可通过 <code>recursive_glob.enabled</code> 配置项关闭</li>
</ol>
<h2 id="recursive_globenabled"><a class="markdownIt-Anchor" href="#recursive_globenabled"></a> recursive_glob.enabled:</h2>
<p>是否开启递归的 Glob 模式，默认为 true。</p>
<h2 id="encoding"><a class="markdownIt-Anchor" href="#encoding"></a> encoding</h2>
<p>指定日志编码，默认是 plain。即 ASCII 模式</p>
<h2 id="exclude_lines"><a class="markdownIt-Anchor" href="#exclude_lines"></a> exclude_lines</h2>
<p>可指定多个正则表达式，来去除某些不需要上报的行。例如：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">filebeat.inputs:</span></span><br><span class="line"><span class="attr">- type:</span> <span class="string">log</span></span><br><span class="line">  <span class="string">...</span></span><br><span class="line"><span class="attr">  exclude_lines:</span> <span class="string">['^DBG']</span></span><br></pre></td></tr></table></figure>
<p>该配置将会去除以 <code>DBG</code> 开头的行。</p>
<h2 id="include_lines"><a class="markdownIt-Anchor" href="#include_lines"></a> include_lines</h2>
<p>可指定多项正则表达式，来仅上报匹配的行。例如：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">filebeat.inputs:</span></span><br><span class="line"><span class="attr">- type:</span> <span class="string">log</span></span><br><span class="line">  <span class="string">...</span></span><br><span class="line"><span class="attr">  include_lines:</span> <span class="string">['^ERR',</span> <span class="string">'^WARN'</span><span class="string">]</span></span><br></pre></td></tr></table></figure>
<p>该配置将会仅上报以 <code>ERR</code> 和 <code>WARN</code> 开头的行。</p>
<p>问题来了，如果同时指定了 exclude_lines 和 include_lines 会怎么处理？</p>
<p>对于这种情况，Filebeat 将会先校验 include_lines，再校验 exclude_lines，其代码实现如下：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *Harvester)</span> <span class="title">shouldExportLine</span><span class="params">(line <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(h.config.IncludeLines) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> !harvester.MatchAny(h.config.IncludeLines, line) &#123;</span><br><span class="line">			<span class="comment">// drop line</span></span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(h.config.ExcludeLines) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> harvester.MatchAny(h.config.ExcludeLines, line) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="exclude_files"><a class="markdownIt-Anchor" href="#exclude_files"></a> exclude_files</h2>
<p>可指定多个正则表达式，匹配到的文件名将不会被处理。</p>
<p>例如:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">exclude_files:</span> <span class="string">['.gz$']</span></span><br></pre></td></tr></table></figure>
<div class="note danger">
            <p>这里需要注意的是，不管是 exclude_files，还是 exclude_lines、include_lines, 声明正则的时候，最好使用单引号引用正则表达式，不要用双引号。否则 yaml 会报转义问题</p>
          </div>
<h2 id="harvester_buffer_size"><a class="markdownIt-Anchor" href="#harvester_buffer_size"></a> harvester_buffer_size</h2>
<p>读文件时的 buffer 大小，最终会应用在 golang 的 <code>File.Read</code> 函数上面。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *File)</span> <span class="title">Read</span><span class="params">(b []<span class="keyword">byte</span>)</span> <span class="params">(n <span class="keyword">int</span>, err error)</span></span></span><br></pre></td></tr></table></figure>
<p>默认是 16384。即 16k。</p>
<h2 id="max_bytes"><a class="markdownIt-Anchor" href="#max_bytes"></a> max_bytes</h2>
<p>表示一条 log 消息的最大 bytes 数目。超过这个大小，剩余就会被截断。<br>
默认值为 10485760(即 10MB)。</p>
<h2 id="multiline"><a class="markdownIt-Anchor" href="#multiline"></a> multiline</h2>
<p>multiline 是为了解决需要多行聚合在一起发送的情况，例如 Java Stack Traces 信息等。<br>
虽然 filebeat 默认不开启 multiline，但是官方的配置文件给了一个例子，可以支持 Java Stack Traces 或者是 C 语言式的换行连续符 <code>\</code>,  可在 <a href="https://www.elastic.co/guide/en/beats/filebeat/master/_examples_of_multiline_configuration.html" target="_blank" rel="noopener">Examples of multiline configuration</a> 中查看。</p>
<p>由于大部分场景不涉及 multiline，本文不再进行深入讨论。关于 multiline 配置的详细资料可查看官方文档：<br>
<a href="https://www.elastic.co/guide/en/beats/filebeat/7.5/multiline-examples.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/7.5/multiline-examples.html</a></p>
<h2 id="ignore_older"><a class="markdownIt-Anchor" href="#ignore_older"></a> ignore_older</h2>
<p>ignore_older 表示对于最近修改时间距离当前时间已经超过某个时长的文件，就暂时不进行处理。默认值为 0，表示禁用该功能。</p>
<p>注意：ignore_older 只是暂时不处理该文件，并不会在 Registrar 中改变该文件的状态。</p>
<p>其代码实现如下：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Input)</span> <span class="title">isIgnoreOlder</span><span class="params">(state file.State)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="comment">// ignore_older is disable</span></span><br><span class="line">	<span class="keyword">if</span> p.config.IgnoreOlder == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	modTime := state.Fileinfo.ModTime()</span><br><span class="line">	<span class="keyword">if</span> time.Since(modTime) &gt; p.config.IgnoreOlder &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="close_-系列"><a class="markdownIt-Anchor" href="#close_-系列"></a> close_* 系列</h2>
<p>log input 中有一系列以 close_开头配置，这些配置决定了 Harvester 何时结束对文件的读取。</p>
<ol>
<li>close_eof<br>
如果读取到了 EOF(即文件末尾)，是否要结束读取。如果为 true，则读取到文件末尾就结束读取，否则 Harvester 将会继续工作。默认只为 false。</li>
<li>close_inactive<br>
如果配置了 close_eof 为 false，则 Harvester 即使读取到了文件末尾也不会终止。close_inactive 决定了最长没有读到新消息的时长，默认为 5m(即五分钟)。如果超过了 close_inactive 规定的时间依然没有新消息，则 Harvester 退出。</li>
<li>close_timeout<br>
决定了一个 Harvester 的最长工作时间，如果 Harvester 工作了一段时间后依然没有停止，则强行停止 Harvester。默认为 0，表示不强行停止 Harvester。</li>
<li>close_renamed<br>
文件更名时是否退出，默认为 false。文件更名一般发生在日志轮替的场景下。</li>
<li>close_removed<br>
表示当文件被删除时 Harvester 是否要继续。默认为 true，表示当文件被删除时，Harvester 即刻停止工作。</li>
</ol>
<p>不过即使 Harvester 关闭了也关系不大。因为根据 filebeat 会定时扫描文件，如果关闭后又有了新增内容，filebeat 依然是可以检查出来的。</p>
<h2 id="clean_-系列"><a class="markdownIt-Anchor" href="#clean_-系列"></a> clean_* 系列</h2>
<p>clean_开头的一系列配置用来清理 Registrar 中的文件状态，同时也可以起到减小 Registrar 文件大小、防止 inode 复用等作用。</p>
<ol>
<li>
<p>clean_inactive<br>
表示一个时间段。用于移除已经一长段时间没有新产生内容的日志文件，默认为 0，表示禁用该功能。</p>
</li>
<li>
<p>clean_removed<br>
在 Registrar 中移除那些已经不存在的文件。默认为 true，表示当文件不存在时，则从 Registrar 中移除。</p>
</li>
</ol>
<h2 id="scan_frequency"><a class="markdownIt-Anchor" href="#scan_frequency"></a> scan_frequency</h2>
<p>代表 input 的扫描频率，默认为 10s。<br>
input 会按照此频率，启动定时器定时扫描路径，以发现新文件和文件的改动情况。</p>
<h2 id="scansort-和-scanorder"><a class="markdownIt-Anchor" href="#scansort-和-scanorder"></a> scan.sort 和 scan.order</h2>
<p>这两个配置项需要放在一起讲。<br>
<code>scan.sort</code> 可取的值为: modtime 和 filename。默认值为空，不进行排序。<br>
<code>scan.order</code> 可取的值为：asc 和 desc。默认值为 asc。<code>scan.order</code> 仅在 <code>scan.sort</code> 非空时生效。</p>
<p>需要注意的是：该功能目前为实验功能，可能会在以后版本移除。</p>
<h2 id="tail_files"><a class="markdownIt-Anchor" href="#tail_files"></a> tail_files</h2>
<p>默认情况下，Harvester 处理文件时，会文件头开始读取文件。开启此功能后，filebeat 将直接会把文件的 offset 置到末尾，从文件末尾监听消息。默认值是 false。</p>
<p>注意： 开启了 tail_files, 则所有文件中的当前内容将不会被上报，只有新产生消息时才会上报。</p>
<p>在真实的实现中，tail_files 被当做 <code>ignore_older=1ns</code> 处理。因此，在启动的时候，只要是新文件，里面的内容都会被忽略，直接把 offset 置为文件末尾。</p>
<p>所以使用该配置项时千万要谨慎！</p>
<h2 id="harvester_limit"><a class="markdownIt-Anchor" href="#harvester_limit"></a> harvester_limit</h2>
<p>harvester_limit 决定了一个 input 最多同时有多少个 harvester 启动。默认为 0，代表不对 harvester 个数进行限制。<br>
在使用时要注意两点：</p>
<ol>
<li>如果一个文件对应的 harvester 在本轮扫描时没能启动，那会在下次扫描时，有其他文件的 harvester 完全退出时，该文件的 harvester 才能启动。</li>
<li>harvester_limit 仅对针对配置的 input 进行了限制，多个 input 之间的 harvester_limit 互不影响。</li>
</ol>
<h2 id="symlinks"><a class="markdownIt-Anchor" href="#symlinks"></a> symlinks</h2>
<p>代表是否要对符号链接进行处理，默认值为 false，代表不处理。</p>
<h2 id="backoff-相关配置"><a class="markdownIt-Anchor" href="#backoff-相关配置"></a> backoff 相关配置</h2>
<p>我们上文讲到 <code>close_eof</code> 选项，当读取到 eof 时，且 close_eof 为 false，则 Harvester 还会一直尝试读取文件。</p>
<p>在这种情况下，Harvester 继续读取之前，其实 filebeat 还会等待一段时间。等待的时长就是由 <code>backoff</code>、<code>backoff_factor</code> 和 <code>max_backoff</code> 三个配置项共同决定。</p>
<p>对应的代码实现为：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *Log)</span> <span class="title">wait</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// Wait before trying to read file again. File reached EOF.</span></span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> &lt;-f.done:</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	<span class="keyword">case</span> &lt;-time.After(f.backoff):</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Increment backoff up to maxBackoff</span></span><br><span class="line">	<span class="keyword">if</span> f.backoff &lt; f.config.MaxBackoff &#123;</span><br><span class="line">		f.backoff = f.backoff * time.Duration(f.config.BackoffFactor)</span><br><span class="line">		<span class="keyword">if</span> f.backoff &gt; f.config.MaxBackoff &#123;</span><br><span class="line">			f.backoff = f.config.MaxBackoff</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中，<code>backoff</code> 默认值为 1s, <code>backoff_factor</code> 默认值为 2，<code>max_backoff</code> 默认值为 10s。</p>
<p>该配置项意味着，如果读到 EOF，则 filebeat 将会等待一段时间再去读文件。<br>
等待时间开始为 1s，如果一直是 EOF，则会逐渐增大等待时间，每次的等待时间是前一次的两倍，且一次最长等待 10s。</p>
<p>再结合 <code>close_inactive</code> 选项，如果等待时间超过了默认值 5 分钟，则 Harvester 结束。</p>
<p>此外，如果等待的时候文件又追加了新的数据，则 backoff 将会重新置为初始值。</p>
<h1 id="全局配置"><a class="markdownIt-Anchor" href="#全局配置"></a> 全局配置</h1>
<p>除了 log input 相关的属性外，有一些全局属性也需要我们注意。</p>
<h2 id="queue-相关配置"><a class="markdownIt-Anchor" href="#queue-相关配置"></a> queue 相关配置</h2>
<p>filebeat 会将 event 暂时存放在 queue 里面。filebeat 的 queue 目前有 mem 和 spool 两种实现，默认是 mem。<br>
本文只介绍下 mem 的相关配置项。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">queue:</span></span><br><span class="line"><span class="attr">  mem:</span></span><br><span class="line"><span class="attr">    events:</span> <span class="number">4096</span></span><br><span class="line">    <span class="string">flush.min_events:</span> <span class="number">2048</span></span><br><span class="line">    <span class="string">flush.timeout:</span> <span class="number">1</span><span class="string">s</span></span><br></pre></td></tr></table></figure>
<p>events 代表 queue 最多能够承载的 event 的个数。如果个数达到最大值，则 input 将不能再向 queue 中插入数据，直至 output 将数据消费。</p>
<p><code>flush.min_events</code> 代表只有 queue 里面的数据到达了指定个数，才将数据发送给 output。设为 0 代表直接发送给 output，不进行等待。</p>
<p><code>flush.timeout</code> 代表定时刷新 event 到 output 中，即使其个数没有达到 <code>flush.min_events</code>。该配置项只会在 <code>flush.min_events</code> 大于 0 时生效。</p>
<h2 id="registry-相关配置"><a class="markdownIt-Anchor" href="#registry-相关配置"></a> registry 相关配置</h2>
<ol>
<li>filebeat.registry.path<br>
定制 registry 文件的目录，默认值是 <code>registry</code>。</li>
</ol>
<p>注意，这里指定的只是 registry 的目录，最终的 registry 文件的路径会是这样:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$&#123;filebeat.registry.path&#125;/filebeat/data.json</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>
<p>filebeat.registry.flush<br>
将 registry 文件内容定时刷新到磁盘中。默认为 0s，代表每次更新时直接写文件。<br>
配置了该选项可以提高些 filebeat 的性能，避免频繁写磁盘，但是也增加了一定数据丢失的风险。</p>
</li>
<li>
<p>filebeat.registry.file_permissions<br>
默认为 0600，即只有拥有者可以读写该用户, 其他用户不可以修改。</p>
</li>
</ol>
<h2 id="日志相关配置"><a class="markdownIt-Anchor" href="#日志相关配置"></a> 日志相关配置</h2>
<p>filebeat 可以对输出日志的进行相关配置，filebeat 提供了如下日志相关的配置:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">logging.level:</span> <span class="string">info</span> <span class="comment"># 日志输出的最小级别</span></span><br><span class="line"><span class="string">logging.selectors:</span> <span class="string">[]</span> <span class="comment"># 过滤器，用户可在 logp.NewLogger 时指定</span></span><br><span class="line"><span class="string">logging.to_stderr:</span> <span class="literal">false</span> <span class="comment"># 将日志输出到 stderr</span></span><br><span class="line"><span class="string">logging.to_syslog:</span> <span class="literal">false</span> <span class="comment"># 将日志输出到 syslog (主要用于 unix)</span></span><br><span class="line"><span class="string">logging.to_eventlog:</span> <span class="literal">false</span> <span class="comment"># 将日志输出到 windows 的 event log</span></span><br><span class="line"><span class="string">logging.to_files:</span> <span class="literal">true</span> <span class="comment"># 将日志输出到文件中</span></span><br><span class="line"><span class="string">logging.files:</span></span><br><span class="line">	<span class="attr">path:</span> <span class="string">$&#123;filebeat_bin_path&#125;/logs/</span> <span class="comment"># 日志目录</span></span><br><span class="line">	<span class="attr">name:</span> <span class="string">filebeat</span>  <span class="comment"># 文件名 filebeat filebeat.1 filebeat.2</span></span><br><span class="line">	<span class="attr">rotateonstartup:</span> <span class="literal">true</span> <span class="comment"># 在 filebeat 启动时进行日志轮替</span></span><br><span class="line">	<span class="attr">rotateeverybytes:</span> <span class="number">10485760</span> <span class="comment"># = 10MB 日志轮替的默认值</span></span><br><span class="line">	<span class="attr">keepfiles:</span> <span class="number">7</span> <span class="comment"># 日志保留个数</span></span><br><span class="line">	<span class="attr">permissions:</span> <span class="number">0600</span> <span class="comment"># 日志权限</span></span><br><span class="line">	<span class="attr">interval:</span> <span class="number">0</span> <span class="comment"># 日志轮替</span></span><br><span class="line"><span class="string">logging.metrics.enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="string">logging.metrics.period:</span> <span class="number">30</span><span class="string">s</span></span><br><span class="line"><span class="string">logging.json:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>filebeat 可以选择将日志输出到许多地方，在线上运营时我们常常会将日志输出到文件, 所以接下来讲下文件相关的配置。</p>
<p>我们可以配置日志文件的所在目录以及文件名，分别对应 <code>logging.files.path</code> 和 <code>logging.files.name</code>。<br>
默认情况下，日志的输出目录是在 filebeat 的 bin 文件所在目录下的 logs 文件。</p>
<p>filebeat 会进行日志轮替，一般情况下，常见的日志轮替规则有按大小和按时间，filebeat 两种规则均支持。<br>
其中:</p>
<ol>
<li><code>rotateeverybytes</code> 决定了日志文件的最大值，如果日志文件超过了该值，将发生日志轮替，默认值为 10MB。</li>
<li><code>rotateonstartup</code> 是说明是否在每次启动时都进行一次日志轮替，这样的话，每次启动的日志都会从一个新文件开始。默认为 true</li>
</ol>
<p>按文件大小进行轮替后，日志文件名将会变成 filebeat、filebeat.1、filebeat.2 这种格式，后缀越大文件越旧。</p>
<p>filebeat 也支持按时间进行轮替，可以配置 <code>logging.files</code> 下的 interval 属性，支持按照秒、分钟、小时、周、月、年进行轮替，对应值为 <code>1s</code>,<code>1m</code>, <code>1h</code>, <code>24h</code>, <code>7*24h</code>, <code>30*24h</code>, 和 <code>365*24h</code>。当然，最小值是 1s。</p>
<p>按照时间进行轮替时，时间将会以连字符进行分割, 例如：按照 1 小时进行轮替的话，文件格式为：<code>filebeat-2019-11-28-15</code>。filebeat 目前还不支持日期格式的自定义。</p>
<p>同时，我们也可以指定日志的保留策略，目前只能通过设置 <code>keepfiles</code> 来决定保留日志的个数。</p>
<p>在日志里面还有 <code>logging.metrics</code> 相关配置，filebeat 会定时输出一些当前的运行指标，例如输出下当前 ack 成功的数目、当前的内存占用情况等：</p>
<ul>
<li><code>logging.metrics.enabled</code> 决定是否开启指标搜集</li>
<li><code>logging.metrics.period</code> 决定指标输出的间隔</li>
</ul>
<h2 id="使用环境变量"><a class="markdownIt-Anchor" href="#使用环境变量"></a> 使用环境变量</h2>
<p>我们可以在使用配置文件中直接使用环境变量，使用方式如下:</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">fields:</span></span><br><span class="line">	<span class="attr">env:</span> <span class="string">$&#123;ENV_NAME&#125;</span></span><br></pre></td></tr></table></figure>
<p>我们可以直接用 <code>${ENV_NAME}</code> 来引用系统的环境变量。<br>
除了直接引用外，filebeat 还提供了两个表达式配合使用:</p>
<ol>
<li><code>${VAR:default_value}</code>。如果没有环境变量 <code>VAR</code>, 则使用默认值 default_value</li>
<li><code>${VAR:?error_text}</code>。如果没有环境变量 <code>VAR</code>，则显示错误提示 <code>error_text</code></li>
</ol>
<p>filebeat 也支持在启动时指定命令行参数来提供环境变量: <code>-E name=${NAME}</code></p>
<h1 id="相关阅读"><a class="markdownIt-Anchor" href="#相关阅读"></a> 相关阅读</h1>
<ul>
<li><a href="https://www.cyhone.com/articles/analysis-of-filebeat/">Elastic-Filebeat 实现剖析</a></li>
</ul>
<h1 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考</h1>
<ul>
<li><a href="https://www.elastic.co/guide/en/beats/filebeat/7.5/filebeat-input-log.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/7.5/filebeat-input-log.html</a></li>
<li><a href="https://github.com/elastic/beats/blob/7.5/filebeat/filebeat.reference.yml" target="_blank" rel="noopener">https://github.com/elastic/beats/blob/7.5/filebeat/filebeat.reference.yml</a></li>
<li><a href="https://en.wikipedia.org/wiki/Glob_(programming)" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Glob_(programming)</a></li>
<li><a href="https://www.elastic.co/guide/en/beats/filebeat/current/using-environ-vars.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/beats/filebeat/current/using-environ-vars.html</a></li>
</ul>

    </div>

    
    
    
    <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center;">
        <img id="wechat_subscriber_qcode" src="/img/wechat_subscriber_search.png" alt="cyhone wechat" style="width: 750px;max-width:100%;">
    <!--div>欢迎关注公众号【编程沉思录】</div-->
    </div>
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>cyhone
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://www.cyhone.com/articles/usage-of-filebeat-log-config/" title="FileBeat-Log 相关配置指南">http://www.cyhone.com/articles/usage-of-filebeat-log-config/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Golang/" rel="tag"><i class="fa fa-tag"></i> Golang</a>
              <a href="/tags/Filebeat/" rel="tag"><i class="fa fa-tag"></i> Filebeat</a>
              <a href="/tags/Elasticsearch/" rel="tag"><i class="fa fa-tag"></i> Elasticsearch</a>
              <a href="/tags/大数据/" rel="tag"><i class="fa fa-tag"></i> 大数据</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/articles/analysis-of-redis-ae/" rel="prev" title="Redis 事件循环器 (AE) 实现剖析">
      <i class="fa fa-chevron-left"></i> Redis 事件循环器 (AE) 实现剖析
    </a></div>
      <div class="post-nav-item">
    <a href="/articles/time-wheel-in-libco/" rel="next" title="libco 的定时器实现——时间轮">
      libco 的定时器实现——时间轮 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#log-input-配置"><span class="nav-text"> log input 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#paths"><span class="nav-text"> paths</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#glob-模式"><span class="nav-text"> Glob 模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#递归的-glob-模式"><span class="nav-text"> 递归的 Glob 模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#recursive_globenabled"><span class="nav-text"> recursive_glob.enabled:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#encoding"><span class="nav-text"> encoding</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#exclude_lines"><span class="nav-text"> exclude_lines</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#include_lines"><span class="nav-text"> include_lines</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#exclude_files"><span class="nav-text"> exclude_files</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#harvester_buffer_size"><span class="nav-text"> harvester_buffer_size</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#max_bytes"><span class="nav-text"> max_bytes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#multiline"><span class="nav-text"> multiline</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ignore_older"><span class="nav-text"> ignore_older</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#close_-系列"><span class="nav-text"> close_* 系列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#clean_-系列"><span class="nav-text"> clean_* 系列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#scan_frequency"><span class="nav-text"> scan_frequency</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#scansort-和-scanorder"><span class="nav-text"> scan.sort 和 scan.order</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tail_files"><span class="nav-text"> tail_files</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#harvester_limit"><span class="nav-text"> harvester_limit</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#symlinks"><span class="nav-text"> symlinks</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#backoff-相关配置"><span class="nav-text"> backoff 相关配置</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#全局配置"><span class="nav-text"> 全局配置</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#queue-相关配置"><span class="nav-text"> queue 相关配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#registry-相关配置"><span class="nav-text"> registry 相关配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#日志相关配置"><span class="nav-text"> 日志相关配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用环境变量"><span class="nav-text"> 使用环境变量</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#相关阅读"><span class="nav-text"> 相关阅读</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#参考"><span class="nav-text"> 参考</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="cyhone"
      src="/img/avatar.jpg">
  <p class="site-author-name" itemprop="name">cyhone</p>
  <div class="site-description" itemprop="description">每有会意，便欣然忘食</div>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/chenyahui" title="GitHub → https://github.com/chenyahui" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:cyhone@qq.com" title="E-Mail → mailto:cyhone@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="https://zhuanlan.zhihu.com/ruminations-on-code" title="Zhihu → https://zhuanlan.zhihu.com/ruminations-on-code" rel="noopener" target="_blank"><i class="fa fa-fw fa-custom zhihu"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="rss → /atom.xml"><i class="fa fa-fw fa-rss"></i></a>
      </span>
  </div>


<div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center;">
    <img id="wechat_subscriber_qcode" src="/img/wechat_subscriber.png" alt="cyhone wechat" style="width: 200px; max-width: 100%;">
    <div style="color: #999;font-size: 14px;">
      欢迎关注公众号【编程沉思录】
    </div>
</div>
      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><a href="http://www.beian.miit.gov.cn" rel="noopener" target="_blank">豫ICP备18011028号 </a>
  </div>

<div class="copyright">
  
  &copy; 2015 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cyhone</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.1.0/lib/anime.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el: '#valine-comments',
      verify: false,
      notify: false,
      appId: 'sb9fJUcsRooG9QU63KflHMhU-gzGzoHsz',
      appKey: 'DVy4Enbaa5UpxREeLinbWIcG',
      placeholder: "请在上方填写您的邮箱，邮件不会被公开",
      avatar: 'mm',
      meta: guest,
      pageSize: '10' || 10,
      visitor: true,
      lang: 'zh-cn' || 'zh-cn',
      path: location.pathname,
      recordIP: false,
      serverURLs: ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
